!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r,a,i;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
!function(n,s){"object"==typeof t&&t&&"string"!=typeof t.nodeName?s(t):(a=[t],void 0===(i="function"==typeof(r=s)?r.apply(t,a):r)||(e.exports=i))}(0,function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var o=/\S/;function c(e){return!function(e,t){return s.call(e,t)}(o,e)}var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var u=/\s*/,h=/\s+/,p=/\s*=/,d=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function g(e){this.string=e,this.tail=e,this.pos=0}function v(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function m(){this.cache={}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},g.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},v.prototype.push=function(e){return new v(e,this)},v.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var a,s,o=this,c=!1;o;){if(e.indexOf(".")>0)for(t=o.view,a=e.split("."),s=0;null!=t&&s<a.length;)s===a.length-1&&(c=i(t,a[s])),t=t[a[s++]];else t=o.view[e],c=i(o.view,e);if(c)break;o=o.parent}n[e]=t}return r(t)&&(t=t.call(this.view)),t},m.prototype.clearCache=function(){this.cache={}},m.prototype.parse=function(t,r){var i=this.cache,s=i[t];return null==s&&(s=i[t]=function(t,r){if(!t)return[];var i,s,o,l=[],v=[],m=[],y=!1,_=!1;function b(){if(y&&!_)for(;m.length;)delete v[m.pop()];else m=[];y=!1,_=!1}function w(e){if("string"==typeof e&&(e=e.split(h,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(a(e[0])+"\\s*"),s=new RegExp("\\s*"+a(e[1])),o=new RegExp("\\s*"+a("}"+e[1]))}w(r||e.tags);for(var k,E,S,x,O,C,T=new g(t);!T.eos();){if(k=T.pos,S=T.scanUntil(i))for(var j=0,R=S.length;j<R;++j)c(x=S.charAt(j))?m.push(v.length):_=!0,v.push(["text",x,k,k+1]),k+=1,"\n"===x&&b();if(!T.scan(i))break;if(y=!0,E=T.scan(f)||"name",T.scan(u),"="===E?(S=T.scanUntil(p),T.scan(p),T.scanUntil(s)):"{"===E?(S=T.scanUntil(o),T.scan(d),T.scanUntil(s),E="&"):S=T.scanUntil(s),!T.scan(s))throw new Error("Unclosed tag at "+T.pos);if(O=[E,S,k,T.pos],v.push(O),"#"===E||"^"===E)l.push(O);else if("/"===E){if(!(C=l.pop()))throw new Error('Unopened section "'+S+'" at '+k);if(C[1]!==S)throw new Error('Unclosed section "'+C[1]+'" at '+k)}else"name"===E||"{"===E||"&"===E?_=!0:"="===E&&w(S)}if(C=l.pop())throw new Error('Unclosed section "'+C[1]+'" at '+T.pos);return function(e){for(var t,n=[],r=n,a=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":r.push(t),a.push(t),r=t[4]=[];break;case"/":a.pop()[5]=t[2],r=a.length>0?a[a.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],a=0,i=e.length;a<i;++a)(t=e[a])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(v))}(t,r)),s},m.prototype.render=function(e,t,n){var r=this.parse(e),a=t instanceof v?t:new v(t);return this.renderTokens(r,a,n,e)},m.prototype.renderTokens=function(e,t,n,r){for(var a,i,s,o="",c=0,l=e.length;c<l;++c)s=void 0,"#"===(i=(a=e[c])[0])?s=this.renderSection(a,t,n,r):"^"===i?s=this.renderInverted(a,t,n,r):">"===i?s=this.renderPartial(a,t,n,r):"&"===i?s=this.unescapedValue(a,t):"name"===i?s=this.escapedValue(a,t):"text"===i&&(s=this.rawValue(a)),void 0!==s&&(o+=s);return o},m.prototype.renderSection=function(e,t,a,i){var s=this,o="",c=t.lookup(e[1]);if(c){if(n(c))for(var l=0,u=c.length;l<u;++l)o+=this.renderTokens(e[4],t.push(c[l]),a,i);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)o+=this.renderTokens(e[4],t.push(c),a,i);else if(r(c)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,i.slice(e[3],e[5]),function(e){return s.render(e,t,a)}))&&(o+=c)}else o+=this.renderTokens(e[4],t,a,i);return o}},m.prototype.renderInverted=function(e,t,r,a){var i=t.lookup(e[1]);if(!i||n(i)&&0===i.length)return this.renderTokens(e[4],t,r,a)},m.prototype.renderPartial=function(e,t,n){if(n){var a=r(n)?n(e[1]):n[e[1]];return null!=a?this.renderTokens(this.parse(a),t,n,a):void 0}},m.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},m.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},m.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var y=new m;return e.clearCache=function(){return y.clearCache()},e.parse=function(e,t){return y.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+function(e){return n(e)?"array":typeof e}(e)+'" was given as the first argument for mustache#render(template, view, partials)');return y.render(e,t,r)},e.to_html=function(t,n,a,i){var s=e.render(t,n,a);if(!r(i))return s;i(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return l[e]})},e.Scanner=g,e.Context=v,e.Writer=m,e})},function(e,t,n){(function(t){var r=n(3),a="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function i(e){return void 0===e}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"[object String]"===Object.prototype.toString.call(e)}function c(e){return"[object Array]"===Object.prototype.toString.call(e)}function l(){if(!("fetch"in a))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function u(e,t){var n,r;if(i(e.length))for(n in e)p(e,n)&&t.call(null,n,e[n]);else if(r=e.length)for(n=0;n<r;n++)t.call(null,n,e[n])}function h(e,t){if("number"!=typeof t)throw new Error("2nd argument to `truncate` function should be a number");return"string"!=typeof e||0===t?e:e.length<=t?e:e.substr(0,t)+"…"}function p(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e){for(var t,n=[],r=0,a=e.length;r<a;r++)o(t=e[r])?n.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):t&&t.source&&n.push(t.source);return new RegExp(n.join("|"),"i")}function f(e){var t,n,r,a,i,s=[];if(!e||!e.tagName)return"";if(s.push(e.tagName.toLowerCase()),e.id&&s.push("#"+e.id),(t=e.className)&&o(t))for(n=t.split(/\s+/),i=0;i<n.length;i++)s.push("."+n[i]);var c=["type","name","title","alt"];for(i=0;i<c.length;i++)r=c[i],(a=e.getAttribute(r))&&s.push("["+r+'="'+a+'"]');return s.join("")}function g(e,t){return!!(!!e^!!t)}function v(e,t){if(g(e,t))return!1;var n,r,a=e.frames,i=t.frames;if(void 0===a||void 0===i)return!1;if(a.length!==i.length)return!1;for(var s=0;s<a.length;s++)if(n=a[s],r=i[s],n.filename!==r.filename||n.lineno!==r.lineno||n.colno!==r.colno||n.function!==r.function)return!1;return!0}var m=3,y=51200,_=40;function b(e){return function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(e))}function w(e){if("string"==typeof e){return h(e,40)}if("number"==typeof e||"boolean"==typeof e||void 0===e)return e;var t=Object.prototype.toString.call(e);return"[object Object]"===t?"[Object]":"[object Array]"===t?"[Array]":"[object Function]"===t?e.name?"[Function: "+e.name+"]":"[Function]":e}e.exports={isObject:function(e){return"object"==typeof e&&null!==e},isError:function(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},isErrorEvent:function(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)},isDOMError:function(e){return"[object DOMError]"===Object.prototype.toString.call(e)},isDOMException:function(e){return"[object DOMException]"===Object.prototype.toString.call(e)},isUndefined:i,isFunction:function(e){return"function"==typeof e},isPlainObject:s,isString:o,isArray:c,isEmptyObject:function(e){if(!s(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},supportsErrorEvent:function(){try{return new ErrorEvent(""),!0}catch(e){return!1}},supportsDOMError:function(){try{return new DOMError(""),!0}catch(e){return!1}},supportsDOMException:function(){try{return new DOMException(""),!0}catch(e){return!1}},supportsFetch:l,supportsReferrerPolicy:function(){if(!l())return!1;try{return new Request("pickleRick",{referrerPolicy:"origin"}),!0}catch(e){return!1}},supportsPromiseRejectionEvent:function(){return"function"==typeof PromiseRejectionEvent},wrappedCallback:function(e){return function(t,n){var r=e(t)||t;return n&&n(r)||r}},each:u,objectMerge:function(e,t){return t?(u(t,function(t,n){e[t]=n}),e):e},truncate:h,objectFrozen:function(e){return!!Object.isFrozen&&Object.isFrozen(e)},hasKey:p,joinRegExp:d,urlencode:function(e){var t=[];return u(e,function(e,n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}),t.join("&")},uuid4:function(){var e=a.crypto||a.msCrypto;if(!i(e)&&e.getRandomValues){var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(t[0])+n(t[1])+n(t[2])+n(t[3])+n(t[4])+n(t[5])+n(t[6])+n(t[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},htmlTreeAsString:function(e){for(var t,n=[],r=0,a=0,i=" > ".length;e&&r++<5&&!("html"===(t=f(e))||r>1&&a+n.length*i+t.length>=80);)n.push(t),a+=t.length,e=e.parentNode;return n.reverse().join(" > ")},htmlElementAsString:f,isSameException:function(e,t){return!g(e,t)&&(e=e.values[0],t=t.values[0],e.type===t.type&&e.value===t.value&&!function(e,t){return i(e)&&i(t)}(e.stacktrace,t.stacktrace)&&v(e.stacktrace,t.stacktrace))},isSameStacktrace:v,parseUrl:function(e){if("string"!=typeof e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/),n=t[6]||"",r=t[8]||"";return{protocol:t[2],host:t[4],path:t[5],relative:t[5]+n+r}},fill:function(e,t,n,r){if(null!=e){var a=e[t];e[t]=n(a),e[t].__raven__=!0,e[t].__orig__=a,r&&r.push([e,t,a])}},safeJoin:function(e,t){if(!c(e))return"";for(var n=[],r=0;r<e.length;r++)try{n.push(String(e[r]))}catch(e){n.push("[value cannot be serialized]")}return n.join(t)},serializeException:function e(t,n,a){if(!s(t))return t;a="number"!=typeof(n="number"!=typeof n?m:n)?y:a;var i=function e(t,n){return 0===n?w(t):s(t)?Object.keys(t).reduce(function(r,a){return r[a]=e(t[a],n-1),r},{}):Array.isArray(t)?t.map(function(t){return e(t,n-1)}):w(t)}(t,n);return b(r(i))>a?e(t,n-1):i},serializeKeysForMessage:function(e,t){if("number"==typeof e||"string"==typeof e)return e.toString();if(!Array.isArray(e))return"";if(0===(e=e.filter(function(e){return"string"==typeof e})).length)return"[object has no keys]";if(t="number"!=typeof t?_:t,e[0].length>=t)return e[0];for(var n=e.length;n>0;n--){var r=e.slice(0,n).join(", ");if(!(r.length>t))return n===e.length?r:r+"…"}return""},sanitize:function(e,t){if(!c(t)||c(t)&&0===t.length)return e;var n,a=d(t),i="********";try{n=JSON.parse(r(e))}catch(t){return e}return function e(t){return c(t)?t.map(function(t){return e(t)}):s(t)?Object.keys(t).reduce(function(n,r){return a.test(r)?n[r]=i:n[r]=e(t[r]),n},{}):t}(n)}}}).call(this,n(0))},function(e,t){function n(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function r(e,t){var r=[],a=[];return null==t&&(t=function(e,t){return r[0]===t?"[Circular ~]":"[Circular ~."+a.slice(0,n(r,t)).join(".")+"]"}),function(i,s){if(r.length>0){var o=n(r,this);~o?r.splice(o+1):r.push(this),~o?a.splice(o,1/0,i):a.push(i),~n(r,s)&&(s=t.call(this,i,s))}else r.push(s);return null==e?s instanceof Error?function(e){var t={stack:e.stack,message:e.message,name:e.name};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}(s):s:e.call(this,i,s)}}(e.exports=function(e,t,n,a){return JSON.stringify(e,r(t,a),n)}).getSerialize=r},function(e,t,n){"use strict";n.r(t);n(6);var r=n(1),a=n.n(r);function i(e,t,n){void 0===n&&(n=!e.classList.contains(t)),n?e.classList.add(t):e.classList.remove(t)}function s(){return(new Date).getTime()}var o=Array.prototype.forEach;function c(e,t,n){e instanceof NodeList||e instanceof Array||(e=new Array(e));for(var r=0;r<e.length;r++)e[r].attachEvent?e[r].attachEvent("on"+t,n):e[r].addEventListener(t,n)}function l(e){return JSON.parse(JSON.stringify(e))}function u(e){return void 0===e&&(e=!0),document.body.clientWidth<700&&e}NodeList.prototype.forEach=o;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var g=function(){function e(t,n,r,a){f(this,e),this.uri=t,this.app=n,this.data=a||{data:{}},this.scrollTop=1,this.events={},this.template=r||"unknown_view",this.title=r,this.className=r,this.relations={},this.min_loading_time=400,this.fake_loading_delay=200}return d(e,[{key:"checkView",value:function(e){var t=e&&e.target&&e.target.closest('.subcomponent[data-uri="'+this.uri+'"]');return!(!t||t==this.view)&&(this.view=t,this.render(),!0)}},{key:"bindLinks",value:function(){var e=this;this.app.bindLinks(this.view),c(this.view.querySelectorAll('[data-bind="btn-cancel"]'),"click",function(t){t.preventDefault(),e.destroy()}),c(this.view.querySelectorAll('[data-bind="btn-delete"]'),"click",function(t){t.preventDefault(),e.checkView(t),e.delete()}),c(this.view.querySelectorAll('[data-bind="btn-edit"]'),"click",function(t){t.preventDefault(),e.checkView(t),e.edit(!0)}),c(this.view.querySelectorAll('[data-bind="btn-stop-edit"]'),"click",function(t){t.preventDefault(),e.checkView(t),e.edit(!1,null,t.target&&t.target.dataset.scroll)})}},{key:"edit",value:function(e){void 0===e&&(e=!0),this.data.edit_mode=e,!e&&this.is_new?this.delete():this.render()}},{key:"render",value:function(e){var t=this;e||(e=0);var n="rendering "+e+" "+this.uri;console.time(n);var r=document.getElementById(this.template);if(r)if(e>10)console.error("maximum render deep exceed "+e+" when rendering "+this.uri);else{var a="obj-"+this.template;this.data.uri=this.uri,this.data.is_new=this.is_new,this.data.user=this.app.settings.user,Object.keys(r.dataset).forEach(function(e){t[e]=r.dataset[e]}),this.parent&&(this.data.parent_edit_mode=this.parent.data.edit_mode),this.view||(this.view=document.querySelector("."+a+'[data-uri="'+this.uri+'"]')),this.view.innerHTML=this.app.Mustache.render(r.innerHTML,this.data),this.bindLinks(),this.initForm(),this.app.renderIcons(this.view),this.view.querySelectorAll("[data-toolTip]").forEach(function(e){t.toolTip(e,e.dataset.tooltip)}),c(this.view.querySelectorAll('[data-toggle="dropdown"]'),"click",function(){this.parentElement.classList.toggle("open")}),this.view.querySelectorAll(".subcomponent").forEach(function(n){var r=t.app.get(n.dataset.uri,n.dataset.class);r.parent=t,r.view=n,r.render(e+1)}),console.timeEnd(n)}else console.error("Can't find template "+this.template+" when rendering "+this.uri)}},{key:"update",value:function(){var e=this;this.events.update&&this.events.update.length&&this.events.update.forEach(function(e){e()}),this.app.get_subscriptions(this.uri).forEach(function(t){t.relation_update(e)})}},{key:"get",value:function(e,t,n){return"function"==typeof t&&t(),this}},{key:"show",value:function(){return this}},{key:"delete",value:function(e){var t=this.deleteConfirmation||this.app.lang.deleteConfirmation;if(this.app.confirm(t)){var n=this,r=function(t){n.loading(!1),n.events.destroy&&n.events.destroy.forEach(function(e){return e()}),n.destroy(),"function"==typeof e&&e(t)};this.is_new?r():(this.loading(!0),this.app.ajax({url:this.app.settings.endpoints+this.uri,method:"DELETE",callback:r,error:function(e,t){n.loading(!1),n.app.error({status:e,data:t})}}))}}},{key:"on",value:function(e,t){this.events[e]||(this.events[e]=new Array),this.events[e].push(t)}},{key:"off",value:function(e,t){if(this.events[e]){t||(this.events[e]=new Array);var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}},{key:"relation_update",value:function(e){var t=this.relations[e.className];if("function"==typeof t&&(t=t(e)),console.log("relation_update on "+this.uri),t){if("length"in t){var n=t.indexOf(e);e.is_deleted&&n>-1&&t.splice(n,1),e.is_deleted||-1!=n||(this.relation_update_unshift?t.unshift(e.data.data):t.push(e.data.data)),!e.is_deleted&&n>-1&&(t[n]=e.data.data)}else{var r=l(e.data.data);Object.keys(t).forEach(function(e){delete t[e]}),Object.keys(r).forEach(function(e){t[e]=r[e]})}this.render()}else console.log("relation not found "+e.className)}},{key:"toolTip",value:function(e,t){e.dataset.title=t,"tooltip"!=e.dataset.toggle&&(e.dataset.toggle="tooltip",this.app.bindTooltips(e))}},{key:"inputError",value:function(e,t){var n=e.closest('[data-bind="form-group"]')||e;i(n,"has-error",!0),n.dataset.error=t}},{key:"inputRemoveError",value:function(e){var t=e.closest('[data-bind="form-group"]')||e;i(t,"has-error",!1),delete t.dataset.error}},{key:"inputRequired",value:function(e){var t=e.closest('[data-bind="form-group"]')||e;i(t,"has-required",!0),t.dataset.error=this.app.lang.requested}},{key:"inputRemoveRequired",value:function(e){var t=e.closest('[data-bind="form-group"]')||e;i(t,"has-required",!1),delete t.dataset.title}},{key:"loading",value:function(e){if(!this.app.is_revalidating||!e){void 0===e&&(e=!0);for(var t=this;t&&(!t.view||t.is_new);)t=t.parent;if(t&&t.loading)if(e)t===this?(this.loading_start=s(),this.view.classList.add("loading")):t.loading(e);else{var n=1;t.loading_start&&(function(e,t){return s()-e>1e3*t}(t.loading_start,this.min_loading_time/1e3)||(n=this.fake_loading_delay),delete t.loading_start),setTimeout(function(){var e=t.view.closest(".loading");e&&e.classList.remove("loading")},n)}else this.app.loading(e)}}},{key:"serializeControl",value:function(e){e.name;var t=void 0;switch(e.type){case"checkbox":t=e.checked;break;default:t=e.dataset.value?e.dataset.value:e.value}return(e.classList.contains("flatpickr-input")||"date"==e.type)&&(t=t.replace(/(\d+)\.(\d+)\.(\d+)/,"$3-$2-$1")),t}},{key:"serializeChanges",value:function(e){var t=this;e||(e=t.view);var n={};return t.changes&&t.changes.length&&(n=t.changes.reduce(function(e,n){var r=t.serializeControl(n);return""===r&&(r=null),function(e,t,n){return t&&(e[t]=n),e}(e,n.name,r)},{})),n}},{key:"serialize",value:function(e){var t=this,n={};e||(e=t.view);return e.querySelectorAll("input,select,textarea").forEach(function(e){!function(e,t,n){if(n)t&&e[t]?("object"===p(e[t])&&"length"in e[t]||(e[t]=new Array(e[t])),e[t].push(n)):e[t]=n}(n,e.name,t.serializeControl(e))}),this.data.data&&this.data.data.id&&(n.id=this.data.data.id),n}},{key:"submitOnError",value:function(e,t,n){var r=this,a=void 0;if(this.loading(!1),this.validation=n,a=e?e.elements:this.view.querySelectorAll("input,select,textarea"),422===t&&n&&"message_code"in n){if("InvalidData"==n.message_code)return this.app.loading(!1),void this.app.error({status:t,data:n.message});if("ValidationError"==n.message_code||"FormError"==n.message_code){var i=l(n.data);Array.prototype.forEach.call(a,function(e){i[e.name]&&r.inputError(e,Array.prototype.join.call(i[e.name],"\n"))});var s=e||this.view;return void this.app.scrollTo(s.querySelector(".has-error"))}}this.app.error({status:t,data:n})}},{key:"validateForm",value:function(e){var t=this,n=!0;return(e||this.view).querySelectorAll(".required").forEach(function(e){e.name&&!e.value&&(n=!1,t.inputRequired(e))}),n}},{key:"formSubmit",value:function(e,t){t.preventDefault();var n=this;if(this.validateForm(e)){var r=n.serializeChanges(e);if(function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}(r))return console.log("No changes"),void this.edit(!1);var a=e.getAttribute("action")||(this.is_new?this.uri.replace(/new\/?$/,""):this.uri),i={data:r};n.loading(!0),this.app.ajax({url:this.app.settings.endpoints+a,method:this.is_new?"POST":"PUT",data:i,callback:function(e){if(n.changes=[],n.loading(!1),n.data="function"==typeof n.converter?n.converter(e):e,n.update(),n.is_new){var t=n.uri.replace(/new\/?$/,n.data.data.id+"/");n.app.cache[t]=n,n.view.dataset.uri=t,delete n.app.cache[n.uri],n.uri=t,n.is_new=!1}n.app.dataStorage.set(n.uri,e),n.updated=s(),n.get(!1,function(){n.edit(!1),n.render(),n.show()}),n.formSaved()},error:function(t,r){n.submitOnError(e,t,r)}})}else{var o=e||this.view;this.app.scrollTo(o.querySelector(".has-required"))}}},{key:"formSaved",value:function(){var e=this.view.querySelector('[data-bind="alert-success"]');e&&(e.classList.remove("hidden"),e.classList.add("in"),setTimeout(function(){e.classList.remove("in"),setTimeout(function(){e.classList.add("hidden")},1e3)},2e3))}},{key:"formSubmitToggle",value:function(e){var t=this.view.querySelector("form");t&&t.querySelectorAll('[type="submit"],[type="reset"]').forEach(function(t){t.disabled=e})}},{key:"initForm",value:function(){var e=this,t=this;void 0===this.changes&&(this.changes=[]),this.changes.length&&(this.formSubmitToggle(!1),this.changes=this.changes.map(function(t){return e.view.querySelector('[name="'+t.name+'"]')||t})),this.view.querySelectorAll('[data-toggle="buttons"] button, [data-bind="checkbox"]').forEach(function(e){var t=e.querySelector('input[type="checkbox"]')||e.querySelector('input[type="radio"]');t&&i(e,"active",t.checked)});var n=function(e){if("text"!==this.type||!this.classList.contains("flatpickr-input")||e.is_flatpickr_trusted){if(this.dataset.ac){if(!this.dataset.ready)return;delete this.dataset.ready}t.data.data[this.name]!==this.value&&(-1===t.changes.indexOf(this)&&t.changes.push(this),t.auto_serialize&&(t.data.data[this.name]=t.serializeControl(this)),t.inputRemoveError(this),t.inputRemoveRequired(this),t.formSubmitToggle(!1))}};c(this.view.querySelectorAll('[data-toggle="buttons"] button'),"click",function(){var e=this.querySelector('input[type="checkbox"]'),t=this.querySelector('input[type="radio"]'),r=this.closest('[data-toggle="buttons"]');e?(e.checked=!e.checked,i(this,"active",e.checked),n.call(e,event)):t&&(r.querySelectorAll('[name="'+t.name+'"]').forEach(function(e){e.checked=!1}),t.checked=!0,r.querySelectorAll("button").forEach(function(e){i(e,"active",!1)}),i(this,"active",!0),n.call(t,event))}),c(this.view.querySelectorAll('[data-bind="checkbox"]'),"click",function(e){var t=this.querySelector('input[type="checkbox"]');t.checked=!t.checked,i(this,"active",t.checked),t.dispatchEvent(new UIEvent("change",{bubbled:!1,cancelable:!0}))}),this.view.querySelectorAll("select[data-inital_value]").forEach(function(e){var t=Array.prototype.find.call(e.options,function(t){return t.value===e.dataset.inital_value});t&&(t.selected=!0)}),this.initDateControls(this.view,n),this.initAutocompleteControls(this.view),this.view.querySelectorAll("input[placeholder]").forEach(function(e){if("hidden"!==e.type){var t=document.createElement("div"),n=document.createElement("span");t.className="placeholder",e.parentElement.insertBefore(t,e),t.appendChild(e),t.appendChild(n),n.textContent=e.getAttribute("placeholder"),e.removeAttribute("placeholder");var r=function(){i(this,"has-value",this.value)};c(e,"input",r),c(e,"change",r),c(e,"blur",r),r.call(e)}});var r=this.view.querySelectorAll("input, select, textarea");c(r,"touchstart",function(e){e.isTrusted||e.target.focus()}),c(r,"change",n),c(r,"focus",function(e){var t=e.target.closest('[data-bind="card"]'),n=t&&t.querySelector('[data-bind="sticky"]');t&&n&&setTimeout(function(){try{var e=t.getBoundingClientRect(),r=n.getBoundingClientRect();e.height<3*r.height&&t.classList.add("no-sticky")}catch(e){}},100)}),c(r,"blur",function(e){var t=e.target.closest('[data-bind="card"]');t&&t.classList.remove("no-sticky")}),c(this.view.querySelectorAll("input, textarea"),"input",n),this.view.querySelectorAll("form").forEach(function(n){if(c(n,"submit",function(e){e.preventDefault(),t.formSubmit.call(t,this,e)}),c(n,"reset",function(e){t.changes=[],t.render(),t.show()}),t.data&&t.data.data){if(t.data.data.user_request)for(var r in t.data.data.user_request){if("list"!=r)(i=n.querySelector('[name="'+r+'"],[name="'+r+'_id"]'))&&t.inputRequired(i)}if(t.data.data.user_response){var a=document.getElementById("user_response").innerHTML;for(var r in e.app.Mustache.parse(a),t.data.data.user_response)if("list"!=r){var i,s=t.data.data.user_response[r];if(i=n.querySelector('[name="'+r+'"],[name="'+r+'_id"]')){s.errors&&s.errors.length&&t.inputError(i,s.errors.join("<br>"));var o=document.createElement("div");o.innerHTML=e.app.Mustache.render(a,{name:i.name,autocomplete:i.dataset.ac,value:s.val}),i.parentElement.appendChild(o)}}}}})}},{key:"initDateControls",value:function(e,t){var n=this;e.querySelectorAll('input[type="date"],input[type="time"]').forEach(function(e){var r={allowInput:!0};e.setAttribute("autocomplete","off"),"time"==e.type||"time"==e.dataset.type?(r.enableTime=!0,r.noCalendar=!0,r.time_24hr=!0,e.dataset.example="00:00",e.setAttribute("pattern","\\d{2}:\\d{2}")):(e.setAttribute("pattern",n.app.flatpickr.defaultConfig.datePattern),e.dataset.example=n.app.flatpickr.defaultConfig.dateExample,r.parseDate=function(e){if(e.match(/\d+\-\d+\-\d+/)){var t=new Date(e);if(!t.getDate())return;return t}return n.app.flatpickr.parseDate(e,n.app.flatpickr.defaultConfig.dateFormat,!0)}),["maxDate","minDate"].forEach(function(t){e.dataset[t]&&(r[t]=e.dataset[t])}),n.app.flatpickr(e,r),e.nextElementSibling&&e.nextElementSibling.removeAttribute("tabindex"),e.dataset.oldValue=e.value,c(e,"keydown",function(e){13!=e.which&&"Enter"!=e.key||(this._flatpickr.setDate(this.value),t.call(this,{is_flatpickr_trusted:!0}),this._flatpickr.close())}),c(e,"input",function(e){if("none"!=this.style.display&&"hidden"!=this.type){var t=this.getAttribute("placeholder"),n=this.getAttribute("pattern"),r=this.dataset.example,a="selectionStart"in this?this.selectionStart:null;if(t&&n){var i=new RegExp(n),s=this.value,o=this.dataset.old_value||"",c=s+r.substr(s.length);if(c.match(i)){if(t){var l=t.substr(s.length,1);"_"!=l&&s+l!=o&&(this.value=s+l,a&&this.setSelectionRange(a+1,a+1))}}else(c=o+r.substr((""+this.value).length)).match(i)&&(this.value=o,a&&this.setSelectionRange(a,a));this.dataset.old_value=this.value}}}),c(e,"focus",function(){this.getAttribute("placeholder")&&(this.dataset.placeholder=this.getAttribute("placeholder")),"time"==this.type||"time"==this.dataset.type?this.setAttribute("placeholder","__:__"):this.setAttribute("placeholder",n.app.flatpickr.defaultConfig.datePlaceholder)}),c(e,"blur",function(e){this.dataset.placeholder?(this.setAttribute("placeholder",this.dataset.placeholder),this.dataset.placeholder=""):this.removeAttribute("placeholder"),this.dataset.oldValue!=this.value&&(this._flatpickr.setDate(this.value),t.call(this,{is_flatpickr_trusted:!0}))})})}},{key:"initAutocompleteControls",value:function(e){var t=this;e.querySelectorAll("[data-ac]").forEach(function(e){!function(e){function t(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function n(e,n,r,a){c(a||document,n,function(n){for(var a=void 0,i=n.target||n.srcElement;i&&!(a=t(i,e));)i=i.parentElement;a&&r.call(i,n)})}var r={selector:0,source:function(){},minChars:2,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var n=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="ac-s" data-val="'+e.value+'">'+e.option.replace(n,"<b>$1</b>")+"</div>"}};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);for(var i="object"===h(r.selector)?[r.selector]:document.querySelectorAll(r.selector),s=0;s<i.length;s++){var o=i[s];o.sc=document.createElement("div"),o.sc.className="ac-ss "+r.menuClass,o.setAttribute("autocomplete","off"),o.cache={},o.last_val=o.value,o.last_o_val=o.dataset.value,o.updateSC=function(e,t){try{var n=o.getBoundingClientRect();o.sc.style.left=Math.round(n.left+(window.pageXOffset||document.documentElement.scrollLeft)+r.offsetLeft)+"px",o.sc.style.top=Math.round(n.bottom+(window.pageYOffset||document.documentElement.scrollTop)+r.offsetTop)+"px",o.sc.style.width=Math.round(n.right-n.left)+"px"}catch(e){}if(!e&&(o.sc.style.display="block",o.sc.maxHeight||(o.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(o.sc,null):o.sc.currentStyle).maxHeight)),o.sc.suggestionHeight||(o.sc.suggestionHeight=o.sc.querySelector(".ac-s").offsetHeight),o.sc.suggestionHeight))if(t){var a=o.sc.scrollTop,i=t.getBoundingClientRect().top-o.sc.getBoundingClientRect().top;i+o.sc.suggestionHeight-o.sc.maxHeight>0?o.sc.scrollTop=i+o.sc.suggestionHeight+a-o.sc.maxHeight:i<0&&(o.sc.scrollTop=i+a)}else o.sc.scrollTop=0},c(window,"resize",o.updateSC),document.body.appendChild(o.sc),n("ac-s","mouseleave",function(e){var t=o.sc.querySelector(".ac-s.selected");t&&setTimeout(function(){t.className=t.className.replace("selected","")},20)},o.sc),n("ac-s","mouseover",function(e){var t=o.sc.querySelector(".ac-s.selected");t&&(t.className=t.className.replace("selected","")),this.className+=" selected"},o.sc),n("ac-s","mousedown",function(e){t(this,"ac-s")&&(o.value=this.textContent,o.dataset.value=this.dataset.val,o.last_val=o.value,o.last_o_val=o.dataset.value,o.readyHandler(),o.sc.style.display="none",o.selectNextInput())},o.sc),o.selectNextInput=function(){var e=o.form.elements[Array.prototype.indexOf.call(o.form.elements,o)+1];e&&setTimeout(function(){o==document.activeElement&&e.dispatchEvent(new Event("touchstart",{bubbles:!1,cancelable:!0,touches:[]}))},50)},o.setCurrentValue=function(e,t){if(o.waiting_suggest>20)console.log("setCurrentValue waiting_suggest timeout"),o.waiting_suggest=0;else if(o.waiting_suggest)return console.log("setCurrentValue waiting_suggest"),setTimeout(function(){o.setCurrentValue(e,t)},r.delay),void o.waiting_suggest++;var n=o.cache[o.value]||[];console.log("setCurrentValue",n,o.value);var a=!1;return n.forEach(function(e){(e.option.toUpperCase()==o.value.toUpperCase()||e.value==o.value.toUpperCase()||1==n.length&&o.value&&o.value.length>2)&&(o.value=e.option,o.dataset.value=e.value,o.last_val=o.value,o.last_o_val=o.dataset.value,o.readyHandler(),a=!0)}),a&&"function"==typeof e&&e.call(),a||"function"!=typeof t||t.call(),a},o.blurHandler=function(){try{var e=document.querySelector(".ac-ss:hover")}catch(t){e=0}e?o!==document.activeElement&&setTimeout(function(){o.focus()},20):(""!==o.value?o.setCurrentValue(null,function(){o.value=o.last_val,o.dataset.value=o.last_o_val}):(o.value="",o.dataset.value=""),o.sc.style.display="none",setTimeout(function(){o.sc.style.display="none"},350))},c(o,"blur",o.blurHandler);var l=function(e,t){if(t||(t=o.value),o.cache[t]=e,o.waiting_suggest=0,e.length&&t.length>=r.minChars){for(var n="",a=0;a<e.length;a++)n+=r.renderItem(e[a],t);o.sc.innerHTML=n,o.updateSC(0)}else o.sc.style.display="none"};o.keydownHandler=function(e){var t=window.event?e.keyCode:e.which,n=o.sc.querySelector(".ac-s.selected");if((40==t||38==t)&&o.sc.innerHTML){var r=void 0;return n?(r=40==t?n.nextSibling:n.previousSibling)?(n.className=n.className.replace("selected",""),r.className+=" selected",o.value=r.textContent,o.dataset.value=r.dataset.val):(n.className=n.className.replace("selected",""),o.value=o.last_val,o.dataset.value=o.last_o_val,r=0):((r=40==t?o.sc.querySelector(".ac-s"):o.sc.childNodes[o.sc.childNodes.length-1]).className+=" selected",o.value=r.textContent,o.dataset.value=r.dataset.val),o.updateSC(0,r),!1}27==t?(o.value=o.last_val,o.dataset.value=o.last_o_val,o.sc.style.display="none"):13!=t&&9!=t||(n&&"none"!=o.sc.style.display?(13==t&&(e.stopPropagation(),e.preventDefault(),o.selectNextInput()),o.last_val=o.value,o.last_o_val=o.dataset.value,o.readyHandler()):o.setCurrentValue())},c(o,"keydown",o.keydownHandler),o.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(t<35||t>40)&&13!=t&&27!=t){var n=o.value;if(n.length>=r.minChars&&n!=o.last_val){if(clearTimeout(o.timer),r.cache){if(n in o.cache)return void l(o.cache[n]);for(var a=1;a<n.length-r.minChars;a++){var i=n.slice(0,n.length-a);if(i in o.cache&&!o.cache[i].length)return void l([])}}o.timer=setTimeout(function(){r.source.call(o,n,l)},r.delay),o.waiting_suggest=1}}},c(o,"keyup",o.keyupHandler),o.focusHandler=function(e){o.last_val="\n",o.keyupHandler(e)},r.minChars||c(o,"focus",o.focusHandler),o.readyHandler=function(){o.dataset.ready=!0;var e=void 0;"createEvent"in document?(e=document.createEvent("HTMLEvents")).initEvent("change",!1,!0):e=new Event("change",{bubbles:!1,cancelable:!0}),o.dispatchEvent(e),setTimeout(function(){o.sc.style.display="none"},20)}}}({selector:e,source:function(n,r){t.app.ajax({url:t.app.settings.autocomplete+"?name="+e.dataset.ac+"&pattern="+encodeURIComponent(n),callback:function(e){r(e.result,n)}})}}),c(e,"focus",function(e){var t=e.target;setTimeout(function(){t.value&&t===document.activeElement&&t.setSelectionRange(0,t.value.length)},100)})})}},{key:"destroy",value:function(){this.is_deleted=!0,this.update(),delete this.app.cache[this.uri],this.app.dataStorage.remove(this.uri),this.app.hideToolTip()}}]),e}(),v=(function(e){function t(e,n,r,a){return f(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,a))}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(t,g),d(t,[{key:"edit",value:function(e,t,n){var r=this;if(void 0===e&&(e=!0),this.data.edit_mode=e,!e&&this.is_new)this.delete();else{var a=this.view.closest('[data-bind="card"]')||this.view.querySelector('[data-bind="card"]');a&&(a.classList.add("animated"),i(a,"backside",e)),setTimeout(function(){a&&a.classList&&a.classList.remove("animated"),e||r.app.scrollTo(a,n),t&&t()},350)}}}])}(),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.container=t.container,this.seatmap=this.params.seatmap,this.events={},this.Mustache=t.Mustache||Mustache}return m(e,[{key:"renderSeatmap",value:function(e){var t=this.container,n=void 0,r=void 0,a=this.seatmap,i=0,s=a.seatmap[0]?a.seatmap[0].startNum:100,o={is_selectable:this.params.is_selectable,is_example:this.params.is_example,columns:[],rows:[]};if(this.seatmap&&this.seatmap.seatmap&&"length"in this.seatmap.seatmap){for(n=0;n<a.seatmap.length;n+=1)o.columns.push({name:a.seatmap[n].rows?a.seatmap[n].seatName:"",i:n}),a.seatmap[n].seatsCount&&(i=Math.max(i,a.seatmap[n].seatsCount),s=Math.min(s,a.seatmap[n].startNum));for(n=0;n<i;n++){var l={i:n,num:n+s,cols:new Array};for(r=0;r<a.seatmap.length;r++)if(a.seatmap[r].rows){var u={};if(a.seatmap[r].rows[n]){for(var h in void 0===(u=v(u,a.seatmap[r].rows[n])).isExists&&(u.isExists=!0),u.classList=new Array,u)h.match(/^is/)&&u[h]&&u.classList.push(h);u.index=r,u.isExists&&(u.name=a.seatmap[r].startNum+n+a.seatmap[r].seatName)}l.cols.push(u)}else l.cols.push({space:!0});o.rows.push(l)}var p=this;if(t.innerHTML=this.Mustache.render(this.params.templates.seatmap,o),c(t.querySelectorAll("tbody td"),"click",function(e){p.seatmapClick(this,e)}),this.params.is_example){var d=t.querySelector('[data-bind="seatmap"]'),f=window.document.getElementById("text-example").innerHTML.replace(/>\s+</g,"><").trim();d.style.backgroundImage="url('data:image/svg+xml;utf8,"+f+"')"}}else t.innerHTML=this.Mustache.render(this.params.templates.seatmap,{})}},{key:"on",value:function(e,t){this.events[e]=t}},{key:"off",value:function(e){this.events[e]=null}},{key:"getCurrentSeats",value:function(){var e=[];return this.seatmap.seatmap.forEach(function(t){t.rows&&t.rows.length&&t.rows.forEach(function(n,r){n.isCurrent&&e.push(t.startNum+r+t.seatName)})}),e}},{key:"getSeat",value:function(e,t){var n,r=(""+e).match(/(\d+)(\w+)|(\w+)(\d+)/),a=void 0,i=void 0;if(r&&(parseInt(r[1])?(i=r[2],a=parseInt(r[1])):(i=r[3],a=parseInt(r[4])),NaN!=a&&i))return(n=this.seatmap.seatmap.find(function(e){return e.seatName===i.toUpperCase()}))&&n.rows?n.rows[a-n.startNum]:null}},{key:"setSeat",value:function(e,t){var n=void 0,r=this.getSeat(e);if(r){for(n in r)delete r[n];for(n in t)r[n]=t[n];return r}}},{key:"has_paid_seats",value:function(e){void 0===e&&(e=this.seatmap);var t=!1;return!(!(e=e.seatmap)||!e.length)&&(e.forEach(function(e){e.rows&&e.rows.length&&e.rows.forEach(function(e){e.isPaid&&(t=!0)})}),t)}},{key:"seatmapClick",value:function(e,t){t.stopPropagation(),t.preventDefault();var n=parseInt(e.dataset.index),r=parseInt(e.closest("tr").dataset.index),a=null;if(NaN!==n&&NaN!==r&&this.seatmap&&this.seatmap.seatmap&&(a=this.seatmap.seatmap[n]),a){var i=""+(r+a.startNum)+a.seatName;"function"==typeof this.events.click&&this.events.click.call(this,{seat:this.getSeat(i),name:i})}else console.log("click to seatmap, column not found ",n,r)}}]),e}(),_=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var b=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.events={},this.threshold=.65,this.drag_holder_class=n&&n.drag_holder_class||"drag-holder",this.drag_class=n&&n.drag_class||"drag",this.dragging_class=n&&n.dragging_class||"dragging",this.holders=t.querySelectorAll("."+this.drag_holder_class),"ontouchstart"in window||navigator.maxTouchPoints?(c(this.container,"touchend",function(e){return r.stopDrag(e)}),c(this.container,"touchcancel",function(e){return r.stopDrag(e)}),c(this.holders,"touchstart",function(e){return r.startDrag(e)}),c(this.holders,"touchend",function(e){return r.stopDrag(e)}),c(this.holders,"touchcancel",function(e){return r.stopDrag(e)}),c(this.holders,"touchmove",function(e){return r.Drag(e)})):(c(this.container,"mouseleave",function(e){return r.stopDrag(e)}),c(this.container,"mouseup",function(e){return r.stopDrag(e)}),c(this.holders,"mousedown",function(e){return r.startDrag(e)}),c(this.holders,"mouseup",function(e){return r.stopDrag(e)}),c(this.holders,"mousemove",function(e){return r.Drag(e)})),c(this.holders,"click",function(e){e.preventDefault(),e.stopPropagation()})}return _(e,[{key:"getTop",value:function(e,t){var n=e.getBoundingClientRect();return(t.type.match("mouse")?t.clientY:t.touches[0].clientY)-Math.round(n.height/2)-n.top}},{key:"Drag",value:function(e){var t=this,n=e.target.closest("."+this.drag_class),r=n.parentElement,a=this.draggHolder;if(e.preventDefault(),e.stopPropagation(),a&&n.classList.contains(this.dragging_class)){var i=this.getTop(n,e);a.style.top=i+"px",this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){var e=!1;if(i>n.clientHeight*t.threshold){var s=n.nextElementSibling;s&&s.nextElementSibling?r.insertBefore(n,s.nextElementSibling):r.appendChild(n),t.changed=!0,e=!0}if(-i>n.clientHeight*t.threshold&&n.previousElementSibling){for(var o=n.previousElementSibling;o&&o.classList.contains("hidden");)o=o.previousElementSibling;o?r.insertBefore(n,o):r.insertBefore(n,n.firstChild),t.changed=!0,e=!0}e&&(a.style.top="0px"),t.timer=0},10)}}},{key:"startDrag",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=e.target;console.log("start"),this.container.querySelectorAll("."+this.dragging_class).forEach(function(e){e.classList.remove(t.dragging_class)}),n.closest("."+this.drag_class).classList.add(this.dragging_class),this.draggHolder=n.closest("."+this.drag_holder_class)||n.querySelector("."+this.drag_holder_class)}},{key:"stopDrag",value:function(e){var t=this;console.log("stopdrag "+e.type),this.container.querySelectorAll("."+this.dragging_class).forEach(function(e){e.classList.remove(t.dragging_class),e.querySelector("."+t.drag_holder_class).style.cssText=""}),this.changed&&(this.change(),this.changed=!1)}},{key:"change",value:function(){this.events.change&&this.events.change.call(this)}},{key:"on",value:function(e,t){this.events[e]=t}}]),e}(),w=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var x=function(e){function t(e,n,r,a){k(this,t);var i=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r||"seatmap_strategies",a));return i.default_modifiers={front:!0,middle:!0,rear:!0},i.css_prefix=i.app.settings.cssPrefix&&i.app.settings.cssPrefix.prefix||"",i}return S(t,g),w(t,[{key:"get",value:function(e,t,n){var r=this;this.data.data||(this.data.data=[]);var a=l(this.data.data),i={};this.data.strategies.forEach(function(e){e&&(i[e.id]=e,a.find(function(t){return"string"==typeof t?e.id===t:t.name==e.id})||a.push(e.id))});var s=Math.min(Math.max(4,this.data.data.length),a.indexOf("find_any_seat")+1,a.length);return this.data.strategiesList=a.map(function(e,t){var n=void 0,a=void 0;if("string"==typeof e?(n=e,a=r.default_modifiers):(n=e.name,a=e.modifiers||r.default_modifiers),!i[n])return console.error("unknown strategy "+n),{strategy:n,index:t+1};var s=l(i[n]);return s.has_modifiers&&(s.modifiers=a),s.index=t+1,s.strategy=s.id,s}).splice(0,s),"function"==typeof t&&t(),this}},{key:"applyStrategy",value:function(e,t,n){var r={},a=e.view.querySelector('[data-bind="seats-not-found"]');r[n]=t,this.app.ajax({method:"POST",data:{data:{seatmap:e.seatmap.seatmap,strategies:r,persons:n}},url:this.app.settings.endpoints+"seatmap/apply_strategy/",callback:function(t){e.clearCurrentSeats(),t&&t.data&&t.data.length?(e.setCurrentSeats(t.data),a.classList.remove("in"),u()||e.seatmap.renderSeatmap()):a.classList.add("in")}})}},{key:"seatmap_preview",value:function(){return this.app.cache[this.view.querySelector(".obj-seatmap_preview").dataset.uri]}},{key:"open",value:function(){this.opened||(this.opened=!0,this.strategiesChange())}},{key:"strategiesChange",value:function(e,n){var r=this,a=[],s=Array.prototype.map.call(this.view.querySelectorAll('[name="strategy"]'),function(e){return e.value});this.view.querySelectorAll('[data-bind="plane-selector"]').forEach(function(e,n){var o=r.data.strategies.find(function(e){return e.id===s[n]}).has_modifiers,c=o?t.serializeModifiers(e):null;c?s[n]={name:s[n],modifiers:c}:o&&(c=r.default_modifiers),i(e,"hidden",!o),a.push({index:n+1,strategy:s[n],modifiers:c,has_modifiers:o})}),this.data.strategiesList=a,this.formSubmitToggle(!1),this.data.data=s,u()&&!n||this.applyStrategy(this.seatmap_preview(),s,this.data.num)}},{key:"initForm",value:function(){var e=this,n=this.view.querySelector('[data-bind="seatmap-container"]');console.log("Creating draglist with prefix '"+this.css_prefix+"'");var r=new b(this.view.querySelector('[data-bind="drag-list"]'),{drag_holder_class:this.css_prefix+"drag-holder",drag_class:this.css_prefix+"drag",dragging_class:this.css_prefix+"dragging"}),a=this;(function e(t,n,r){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in a)return a.value;var s=a.get;return void 0!==s?s.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initForm",this).call(this),r.on("change",function(t){return e.strategiesChange(t)}),c(this.view.querySelectorAll('[data-bind="apply"]'),"click",function(){e.strategiesChange(null,!0),u()&&(n.classList.add("in"),e.app.scrollTo(n))}),c(this.view.querySelectorAll('[data-bind="add-strategy"]'),"click",function(t){var n=e.data.strategies[0].has_modifiers;e.data.strategiesList.push({index:e.data.strategiesList.length,strategy:e.data.strategies[0].id,modifiers:n?e.default_modifiers:null,has_modifiers:n}),e.render()}),c(this.view.querySelectorAll('[name="strategy"]'),"change",function(t){return e.strategiesChange(t)}),c(this.view.querySelectorAll('[data-bind="plane-selector"] button'),"click",function(e){var n=this.closest('[data-bind="plane-selector"]');if(!this.classList.contains("active")&&!t.serializeModifiers(n))return console.log("can't unchecked last plane section"),this.classList.add("active"),void(this.querySelector("input").checked=!0);a.strategiesChange(e)}),c(this.view.querySelectorAll('[data-bind="show"]'),"click",function(r){r.preventDefault();var a=r.target.closest('[data-bind="drag"]'),i=e.data.strategies.find(function(e){return e.id===a.querySelector('[name="strategy"]').value}),s=e.seatmap_preview(),o=t.serializeModifiers(a.querySelector('[data-bind="plane-selector"]'));i.has_modifiers&&o?e.applyStrategy(s,[{name:i.id,modifiers:o}],e.data.num):e.applyStrategy(s,[i.id],e.data.num),u()&&(n.classList.add("in"),e.app.scrollTo(n))}),c(this.view.querySelectorAll('[data-bind="back"]'),"click",function(t){t.preventDefault(),n.classList.remove("in"),e.app.scrollTo(e.view)})}},{key:"formSubmit",value:function(e,t){this.parent.formSubmit(e,t)}}],[{key:"serializeModifiers",value:function(e){var t=!0,n=!0,r={};return e.querySelectorAll("input").forEach(function(e){r[e.name]=e.checked,t=t&&e.checked,n=n&&!e.checked}),t||n?null:r}}]),t}(),O=function(e){function t(e,n,r,a){k(this,t);var i=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r||"seatmap_preview",a));return i.events={},i}return S(t,g),w(t,[{key:"init",value:function(){if(!this.initialized){var e=document.getElementById("seatmap_preview_presets"),t=document.getElementById("seatmap");e&&t&&(this.presets=JSON.parse(e.innerHTML),this.seatmap=new y({seatmap:JSON.parse(JSON.stringify(this.presets[0])),Mustache:this.app.Mustache,is_selectable:!1,is_example:!0,templates:{seatmap:t.innerHTML}}),this.initialized=!0)}}},{key:"render",value:function(){var e=this;this.init(),this.data.presets=new Array,this.presets.forEach(function(t,n){e.data.presets.push({name:t.aircraft,active:n==e.data.preset})}),g.prototype.render.call(this),this.seatmap.container=this.view.querySelector('[data-bind="seatmap-container"]'),this.seatmap.renderSeatmap()}},{key:"on",value:function(e,t){this.events[e]=t}},{key:"setCurrentSeats",value:function(e){var t=this;e.forEach(function(e){t.seatmap.getSeat(e).isCurrent=!0}),this.seatmap.renderSeatmap()}},{key:"clearCurrentSeats",value:function(){var e=this;this.seatmap.getCurrentSeats().forEach(function(t){e.seatmap.setSeat(t,{isEmpty:!0})})}}]),t}();class C extends x{constructor(e,t){const n=t.psg_count||1;super(`seatmap_strategies-${n}/`,new T({endpoints:"https://mw.dev.1check.in/widget/",cssPrefix:{prefix:"och-",ignore:["in","fade","hidden","hidden-xs","hidden-sm","hidden-lg","visible","visible-xs","visible-sm","visible-lg","collapse","collapse-xs","selected","active","subcomponent","isExists","isEmpty","isPaid","isCurrent","flatpickr-input","loading","has-error","has-required","required","no-sticky","placeholder","has-value","ac-s","ac-ss","modal-open"]}}),"widget_seatmap_strategies",{num:n}),this.template_url=t.template_url||"https://static.1check.in/seatmap-widget-template.html",this.template=t.template||"seatmap_strategies",this.onchange=t.onchange,this.view=this.app.root="string"==typeof e?window.document.getElementById(e):e,this.data.num=n,window.document.getElementById(this.template)?this.init():this.app.ajax({url:this.template_url,callback:e=>{const t=document.createElement("div");t.style.display="none",t.innerHTML+=e,document.body.appendChild(t),this.init()},error:(e,t)=>{console.error(`get_template error ${e}: ${t}`)}})}init(){this.data.strategies=JSON.parse(window.document.getElementById("seatmap_strategies_dict").innerHTML)[this.data.num],this.get(),this.render(),this.strategiesChange()}strategiesChange(e,t){super.strategiesChange(e,t),this.onchange&&this.onchange(this.data.data)}}class T{constructor(e){a.a.tags=["<%","%>"],this.Mustache=a.a,this.settings=e,this.cache={},this.default_headers={"Content-Type":"application/json;charset=UTF-8"},this.endpoints=e.endpoints}renderIcons(e){const t=e||this.root,n=this.settings.cssPrefix.prefix;t.querySelectorAll(`.${n}icon`).forEach(e=>{const t=e.className.match(/(icon-\S+)/);t&&document.getElementById(t[1])&&(e.innerHTML=document.getElementById(t[1]).innerHTML)})}bindLinks(e){c((e||this.root).querySelectorAll('[data-toggle="collapse"]'),"click",function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();const t=this.dataset.target||this.getAttribute("href");this.closest(t).classList.toggle("in")})}ajax(e){const t=Object.assign(this.default_headers,e.headers),n=new XMLHttpRequest;try{n.timeout=e.timeout||this.settings.xhr_timeout}catch(e){}"function"!=typeof e.error&&(e.error=((e,t)=>{this.error(e,t)})),"function"!=typeof e.callback&&(e.callback=(()=>{})),n.open(e.method?e.method:"GET",e.url,!0),n.onreadystatechange=function(){if(4===n.readyState){try{n.responseJSON=JSON.parse(n.responseText)}catch(e){}n.status>=200&&n.status<299?e.callback(n.responseJSON||n.responseText):e.error(n.status,n.responseJSON||n.responseText)}},n.ontimeout=(()=>{e.error(0)}),Object.keys(t).forEach(e=>{const r=t[e];null!==r&&n.setRequestHeader(e,r)});const r=e.data?JSON.stringify(e.data):null;try{n.send(r)}catch(e){this.error(0,e)}}error(e,t){window.console.error(e,t)}initObject(e,t,n,r){if(e in this.cache&&!r)return this.cache[e];let a;if("seatmap_preview"===t&&(a=O),!a)return;const i=new a(e,this,t,n||{});return this.cache[i.uri]=i,i}get(e,t,n,r,a){let i=this.cache[e];const s=()=>(i.show(),"function"==typeof r&&r(),i);return i?s():(i=this.initObject(e,t,n)).get(a,s)}scrollTo(e){let t=0,n=window.document.scrollingElement?window.document.scrollingElement.scrollTop:window.pageYOffset;if(e){const n=e.getBoundingClientRect();t=n.top}if(0===t)return;const r=e=>{!function(e){window.document.scrollingElement?window.document.scrollingElement.scrollTop=e:(window.document.body&&(window.document.body.scrollTop=e),window.document.documentElement&&(window.document.documentElement.scrollTop=e))}(n+t*(e=>e*(2-e))(e)),e<1&&setTimeout(()=>{r(e+.02)},7)};r(.02)}}function j(){0}window.onecheckin_widget_seatmap_strategies=C,document.addEventListener("DOMContentLoaded",j,!1)},,function(e,t,n){},function(e,t,n){var r=n(2);e.exports={wrapMethod:function(e,t,n){var a=e[t],i=e;if(t in e){var s="warn"===t?"warning":t;e[t]=function(){var e=[].slice.call(arguments),o=r.safeJoin(e," "),c={level:s,logger:"console",extra:{arguments:e}};"assert"===t?!1===e[0]&&(o="Assertion failed: "+(r.safeJoin(e.slice(1)," ")||"console.assert"),c.extra.arguments=e.slice(1),n&&n(o,c)):n&&n(o,c),a&&Function.prototype.apply.call(a,i,e)}}}}},function(e,t){function n(e){this.name="RavenConfigError",this.message=e}n.prototype=new Error,n.prototype.constructor=n,e.exports=n},function(e,t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function r(e,t,r,a,i,s){return n(function(e,t){return e<<t|e>>>32-t}(n(n(t,e),n(a,s)),i),r)}function a(e,t,n,a,i,s,o){return r(t&n|~t&a,e,t,i,s,o)}function i(e,t,n,a,i,s,o){return r(t&a|n&~a,e,t,i,s,o)}function s(e,t,n,a,i,s,o){return r(t^n^a,e,t,i,s,o)}function o(e,t,n,a,i,s,o){return r(n^(t|~a),e,t,i,s,o)}function c(e,t){var r,c,l,u,h;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var p=1732584193,d=-271733879,f=-1732584194,g=271733878;for(r=0;r<e.length;r+=16)c=p,l=d,u=f,h=g,d=o(d=o(d=o(d=o(d=s(d=s(d=s(d=s(d=i(d=i(d=i(d=i(d=a(d=a(d=a(d=a(d,f=a(f,g=a(g,p=a(p,d,f,g,e[r],7,-680876936),d,f,e[r+1],12,-389564586),p,d,e[r+2],17,606105819),g,p,e[r+3],22,-1044525330),f=a(f,g=a(g,p=a(p,d,f,g,e[r+4],7,-176418897),d,f,e[r+5],12,1200080426),p,d,e[r+6],17,-1473231341),g,p,e[r+7],22,-45705983),f=a(f,g=a(g,p=a(p,d,f,g,e[r+8],7,1770035416),d,f,e[r+9],12,-1958414417),p,d,e[r+10],17,-42063),g,p,e[r+11],22,-1990404162),f=a(f,g=a(g,p=a(p,d,f,g,e[r+12],7,1804603682),d,f,e[r+13],12,-40341101),p,d,e[r+14],17,-1502002290),g,p,e[r+15],22,1236535329),f=i(f,g=i(g,p=i(p,d,f,g,e[r+1],5,-165796510),d,f,e[r+6],9,-1069501632),p,d,e[r+11],14,643717713),g,p,e[r],20,-373897302),f=i(f,g=i(g,p=i(p,d,f,g,e[r+5],5,-701558691),d,f,e[r+10],9,38016083),p,d,e[r+15],14,-660478335),g,p,e[r+4],20,-405537848),f=i(f,g=i(g,p=i(p,d,f,g,e[r+9],5,568446438),d,f,e[r+14],9,-1019803690),p,d,e[r+3],14,-187363961),g,p,e[r+8],20,1163531501),f=i(f,g=i(g,p=i(p,d,f,g,e[r+13],5,-1444681467),d,f,e[r+2],9,-51403784),p,d,e[r+7],14,1735328473),g,p,e[r+12],20,-1926607734),f=s(f,g=s(g,p=s(p,d,f,g,e[r+5],4,-378558),d,f,e[r+8],11,-2022574463),p,d,e[r+11],16,1839030562),g,p,e[r+14],23,-35309556),f=s(f,g=s(g,p=s(p,d,f,g,e[r+1],4,-1530992060),d,f,e[r+4],11,1272893353),p,d,e[r+7],16,-155497632),g,p,e[r+10],23,-1094730640),f=s(f,g=s(g,p=s(p,d,f,g,e[r+13],4,681279174),d,f,e[r],11,-358537222),p,d,e[r+3],16,-722521979),g,p,e[r+6],23,76029189),f=s(f,g=s(g,p=s(p,d,f,g,e[r+9],4,-640364487),d,f,e[r+12],11,-421815835),p,d,e[r+15],16,530742520),g,p,e[r+2],23,-995338651),f=o(f,g=o(g,p=o(p,d,f,g,e[r],6,-198630844),d,f,e[r+7],10,1126891415),p,d,e[r+14],15,-1416354905),g,p,e[r+5],21,-57434055),f=o(f,g=o(g,p=o(p,d,f,g,e[r+12],6,1700485571),d,f,e[r+3],10,-1894986606),p,d,e[r+10],15,-1051523),g,p,e[r+1],21,-2054922799),f=o(f,g=o(g,p=o(p,d,f,g,e[r+8],6,1873313359),d,f,e[r+15],10,-30611744),p,d,e[r+6],15,-1560198380),g,p,e[r+13],21,1309151649),f=o(f,g=o(g,p=o(p,d,f,g,e[r+4],6,-145523070),d,f,e[r+11],10,-1120210379),p,d,e[r+2],15,718787259),g,p,e[r+9],21,-343485551),p=n(p,c),d=n(d,l),f=n(f,u),g=n(g,h);return[p,d,f,g]}function l(e){var t,n="",r=32*e.length;for(t=0;t<r;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function u(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function h(e){var t,n,r="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),r+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return r}function p(e){return unescape(encodeURIComponent(e))}function d(e){return function(e){return l(c(u(e),8*e.length))}(p(e))}function f(e,t){return function(e,t){var n,r,a=u(e),i=[],s=[];for(i[15]=s[15]=void 0,a.length>16&&(a=c(a,8*e.length)),n=0;n<16;n+=1)i[n]=909522486^a[n],s[n]=1549556828^a[n];return r=c(i.concat(u(t)),512+8*t.length),l(c(s.concat(r),640))}(p(e),p(t))}e.exports=function(e,t,n){return t?n?f(t,e):function(e,t){return h(f(e,t))}(t,e):n?d(e):function(e){return h(d(e))}(e)}},function(e,t,n){(function(t){var r=n(2),a={collectWindowErrors:!0,debug:!1},i="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},s=[].slice,o="?",c=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function l(){return"undefined"==typeof document||null==document.location?"":document.location.href}a.report=function(){var e,t,n=[],u=null,h=null,p=null;function d(e,t){var r=null;if(!t||a.collectWindowErrors){for(var i in n)if(n.hasOwnProperty(i))try{n[i].apply(null,[e].concat(s.call(arguments,2)))}catch(e){r=e}if(r)throw r}}function f(t,n,i,s,u){var h=r.isErrorEvent(u)?u.error:u,f=r.isErrorEvent(t)?t.message:t;if(p)a.computeStackTrace.augmentStackTraceWithInitialElement(p,n,i,f),g();else if(h&&r.isError(h))d(a.computeStackTrace(h),!0);else{var v,m={url:n,line:i,column:s},y=void 0;if("[object String]"==={}.toString.call(f))(v=f.match(c))&&(y=v[1],f=v[2]);m.func=o,d({name:y,message:f,url:l(),stack:[m]},!0)}return!!e&&e.apply(this,arguments)}function g(){var e=p,t=u;u=null,p=null,h=null,d.apply(null,[e,!1].concat(t))}function v(e,t){var n=s.call(arguments,1);if(p){if(h===e)return;g()}var r=a.computeStackTrace(e);if(p=r,h=e,u=n,setTimeout(function(){h===e&&g()},r.incomplete?2e3:0),!1!==t)throw e}return v.subscribe=function(r){t||(e=i.onerror,i.onerror=f,t=!0),n.push(r)},v.unsubscribe=function(e){for(var t=n.length-1;t>=0;--t)n[t]===e&&n.splice(t,1)},v.uninstall=function(){t&&(i.onerror=e,t=!1,e=void 0),n=[]},v}(),a.computeStackTrace=function(){function e(e){if(void 0!==e.stack&&e.stack){for(var t,n,r,a=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,i=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,s=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,c=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,u=/\((\S*)(?::(\d+))(?::(\d+))\)/,h=e.stack.split("\n"),p=[],d=(/^(.*) is undefined$/.exec(e.message),0),f=h.length;d<f;++d){if(n=a.exec(h[d])){var g=n[2]&&0===n[2].indexOf("native");n[2]&&0===n[2].indexOf("eval")&&(t=u.exec(n[2]))&&(n[2]=t[1],n[3]=t[2],n[4]=t[3]),r={url:g?null:n[2],func:n[1]||o,args:g?[n[2]]:[],line:n[3]?+n[3]:null,column:n[4]?+n[4]:null}}else if(n=i.exec(h[d]))r={url:n[2],func:n[1]||o,args:[],line:+n[3],column:n[4]?+n[4]:null};else{if(!(n=s.exec(h[d])))continue;n[3]&&n[3].indexOf(" > eval")>-1&&(t=c.exec(n[3]))?(n[3]=t[1],n[4]=t[2],n[5]=null):0!==d||n[5]||void 0===e.columnNumber||(p[0].column=e.columnNumber+1),r={url:n[3],func:n[1]||o,args:n[2]?n[2].split(","):[],line:n[4]?+n[4]:null,column:n[5]?+n[5]:null}}if(!r.func&&r.line&&(r.func=o),r.url&&"blob:"===r.url.substr(0,5)){var v=new XMLHttpRequest;if(v.open("GET",r.url,!1),v.send(null),200===v.status){var m=v.responseText||"",y=(m=m.slice(-300)).match(/\/\/# sourceMappingURL=(.*)$/);if(y){var _=y[1];"~"===_.charAt(0)&&(_=("undefined"==typeof document||null==document.location?"":document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:""))+_.slice(1)),r.url=_.slice(0,-4)}}}p.push(r)}return p.length?{name:e.name,message:e.message,url:l(),stack:p}:null}}function t(e,t,n,r){var a={url:t,line:n};if(a.url&&a.line){if(e.incomplete=!1,a.func||(a.func=o),e.stack.length>0&&e.stack[0].url===a.url){if(e.stack[0].line===a.line)return!1;if(!e.stack[0].line&&e.stack[0].func===a.func)return e.stack[0].line=a.line,!1}return e.stack.unshift(a),e.partial=!0,!0}return e.incomplete=!0,!1}function n(e,i){for(var s,c,u=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,h=[],p={},d=!1,f=n.caller;f&&!d;f=f.caller)if(f!==r&&f!==a.report){if(c={url:null,func:o,line:null,column:null},f.name?c.func=f.name:(s=u.exec(f.toString()))&&(c.func=s[1]),void 0===c.func)try{c.func=s.input.substring(0,s.input.indexOf("{"))}catch(e){}p[""+f]?d=!0:p[""+f]=!0,h.push(c)}i&&h.splice(0,i);var g={name:e.name,message:e.message,url:l(),stack:h};return t(g,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),g}function r(t,r){var i=null;r=null==r?0:+r;try{if(i=e(t))return i}catch(e){if(a.debug)throw e}try{if(i=n(t,r+1))return i}catch(e){if(a.debug)throw e}return{name:t.name,message:t.message,url:l()}}return r.augmentStackTraceWithInitialElement=t,r.computeStackTraceFromStackProp=e,r}(),e.exports=a}).call(this,n(0))},function(e,t,n){(function(t){var r=n(10),a=n(3),i=n(9),s=n(8),o=n(2),c=o.isErrorEvent,l=o.isDOMError,u=o.isDOMException,h=o.isError,p=o.isObject,d=o.isPlainObject,f=o.isUndefined,g=o.isFunction,v=o.isString,m=o.isArray,y=o.isEmptyObject,_=o.each,b=o.objectMerge,w=o.truncate,k=o.objectFrozen,E=o.hasKey,S=o.joinRegExp,x=o.urlencode,O=o.uuid4,C=o.htmlTreeAsString,T=o.isSameException,j=o.isSameStacktrace,R=o.parseUrl,q=o.fill,A=o.supportsFetch,L=o.supportsReferrerPolicy,D=o.serializeKeysForMessage,N=o.serializeException,H=o.sanitize,M=n(7).wrapMethod,P="source protocol user pass host port path".split(" "),I=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;function F(){return+new Date}var U="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},B=U.document,z=U.navigator;function $(e,t){return g(t)?function(n){return t(n,e)}:t}function J(){for(var e in this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument=!f(B),this._hasNavigator=!f(z),this._lastCapturedException=null,this._lastData=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={release:U.SENTRY_RELEASE&&U.SENTRY_RELEASE.id,logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],headers:null,collectWindowErrors:!0,captureUnhandledRejections:!0,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:!0,instrument:!0,sampleRate:1,sanitizeKeys:[]},this._fetchDefaults={method:"POST",keepalive:!0,referrerPolicy:L()?"origin":""},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=U.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=F(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=U.location,this._lastHref=this._location&&this._location.href,this._resetBackoff(),this._originalConsole)this._originalConsoleMethods[e]=this._originalConsole[e]}J.prototype={VERSION:"3.26.3",debug:!1,TraceKit:r,config:function(e,t){var n=this;if(n._globalServer)return this._logDebug("error","Error: Raven has already been configured"),n;if(!e)return n;var a=n._globalOptions;t&&_(t,function(e,t){"tags"===e||"extra"===e||"user"===e?n._globalContext[e]=t:a[e]=t}),n.setDSN(e),a.ignoreErrors.push(/^Script error\.?$/),a.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),a.ignoreErrors=S(a.ignoreErrors),a.ignoreUrls=!!a.ignoreUrls.length&&S(a.ignoreUrls),a.whitelistUrls=!!a.whitelistUrls.length&&S(a.whitelistUrls),a.includePaths=S(a.includePaths),a.maxBreadcrumbs=Math.max(0,Math.min(a.maxBreadcrumbs||100,100));var i={xhr:!0,console:!0,dom:!0,location:!0,sentry:!0},s=a.autoBreadcrumbs;"[object Object]"==={}.toString.call(s)?s=b(i,s):!1!==s&&(s=i),a.autoBreadcrumbs=s;var o={tryCatch:!0},c=a.instrument;return"[object Object]"==={}.toString.call(c)?c=b(o,c):!1!==c&&(c=o),a.instrument=c,r.collectWindowErrors=!!a.collectWindowErrors,n},install:function(){var e=this;return e.isSetup()&&!e._isRavenInstalled&&(r.report.subscribe(function(){e._handleOnErrorStackInfo.apply(e,arguments)}),e._globalOptions.captureUnhandledRejections&&e._attachPromiseRejectionHandler(),e._patchFunctionToString(),e._globalOptions.instrument&&e._globalOptions.instrument.tryCatch&&e._instrumentTryCatch(),e._globalOptions.autoBreadcrumbs&&e._instrumentBreadcrumbs(),e._drainPlugins(),e._isRavenInstalled=!0),Error.stackTraceLimit=e._globalOptions.stackTraceLimit,this},setDSN:function(e){var t=this._parseDSN(e),n=t.path.lastIndexOf("/"),r=t.path.substr(1,n);this._dsn=e,this._globalKey=t.user,this._globalSecret=t.pass&&t.pass.substr(1),this._globalProject=t.path.substr(n+1),this._globalServer=this._getGlobalServer(t),this._globalEndpoint=this._globalServer+"/"+r+"api/"+this._globalProject+"/store/",this._resetBackoff()},context:function(e,t,n){return g(e)&&(n=t||[],t=e,e={}),this.wrap(e,t).apply(this,n)},wrap:function(e,t,n){var r=this;if(f(t)&&!g(e))return e;if(g(e)&&(t=e,e=void 0),!g(t))return t;try{if(t.__raven__)return t;if(t.__raven_wrapper__)return t.__raven_wrapper__}catch(e){return t}function a(){var a=[],i=arguments.length,s=!e||e&&!1!==e.deep;for(n&&g(n)&&n.apply(this,arguments);i--;)a[i]=s?r.wrap(e,arguments[i]):arguments[i];try{return t.apply(this,a)}catch(t){throw r._ignoreNextOnError(),r.captureException(t,e),t}}for(var i in t)E(t,i)&&(a[i]=t[i]);return a.prototype=t.prototype,t.__raven_wrapper__=a,a.__raven__=!0,a.__orig__=t,a},uninstall:function(){return r.report.uninstall(),this._detachPromiseRejectionHandler(),this._unpatchFunctionToString(),this._restoreBuiltIns(),this._restoreConsole(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},_promiseRejectionHandler:function(e){this._logDebug("debug","Raven caught unhandled promise rejection:",e),this.captureException(e.reason,{mechanism:{type:"onunhandledrejection",handled:!1}})},_attachPromiseRejectionHandler:function(){return this._promiseRejectionHandler=this._promiseRejectionHandler.bind(this),U.addEventListener&&U.addEventListener("unhandledrejection",this._promiseRejectionHandler),this},_detachPromiseRejectionHandler:function(){return U.removeEventListener&&U.removeEventListener("unhandledrejection",this._promiseRejectionHandler),this},captureException:function(e,t){if(t=b({trimHeadFrames:0},t||{}),c(e)&&e.error)e=e.error;else{if(l(e)||u(e)){var n=e.name||(l(e)?"DOMError":"DOMException"),a=e.message?n+": "+e.message:n;return this.captureMessage(a,b(t,{stacktrace:!0,trimHeadFrames:t.trimHeadFrames+1}))}if(h(e))e=e;else{if(!d(e))return this.captureMessage(e,b(t,{stacktrace:!0,trimHeadFrames:t.trimHeadFrames+1}));t=this._getCaptureExceptionOptionsFromPlainObject(t,e),e=new Error(t.message)}}this._lastCapturedException=e;try{var i=r.computeStackTrace(e);this._handleStackInfo(i,t)}catch(t){if(e!==t)throw t}return this},_getCaptureExceptionOptionsFromPlainObject:function(e,t){var n=Object.keys(t).sort(),r=b(e,{message:"Non-Error exception captured with keys: "+D(n),fingerprint:[i(n)],extra:e.extra||{}});return r.extra.__serialized__=N(t),r},captureMessage:function(e,t){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(e)){var n,a=b({message:e+=""},t=t||{});try{throw new Error(e)}catch(e){n=e}n.name=null;var i=r.computeStackTrace(n),s=m(i.stack)&&i.stack[1];s&&"Raven.captureException"===s.func&&(s=i.stack[2]);var o=s&&s.url||"";if((!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(o))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(o))){if(this._globalOptions.stacktrace||t.stacktrace||""===a.message){a.fingerprint=null==a.fingerprint?e:a.fingerprint,(t=b({trimHeadFrames:0},t)).trimHeadFrames+=1;var c=this._prepareFrames(i,t);a.stacktrace={frames:c.reverse()}}return a.fingerprint&&(a.fingerprint=m(a.fingerprint)?a.fingerprint:[a.fingerprint]),this._send(a),this}}},captureBreadcrumb:function(e){var t=b({timestamp:F()/1e3},e);if(g(this._globalOptions.breadcrumbCallback)){var n=this._globalOptions.breadcrumbCallback(t);if(p(n)&&!y(n))t=n;else if(!1===n)return this}return this._breadcrumbs.push(t),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(e){var t=[].slice.call(arguments,1);return this._plugins.push([e,t]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(e){return this._globalContext.user=e,this},setExtraContext:function(e){return this._mergeContext("extra",e),this},setTagsContext:function(e){return this._mergeContext("tags",e),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(a(this._globalContext))},setEnvironment:function(e){return this._globalOptions.environment=e,this},setRelease:function(e){return this._globalOptions.release=e,this},setDataCallback:function(e){var t=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=$(t,e),this},setBreadcrumbCallback:function(e){var t=this._globalOptions.breadcrumbCallback;return this._globalOptions.breadcrumbCallback=$(t,e),this},setShouldSendCallback:function(e){var t=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=$(t,e),this},setTransport:function(e){return this._globalOptions.transport=e,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!!this._hasJSON&&(!!this._globalServer||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var e=U.RavenConfig;e&&this.config(e.dsn,e.config).install()},showReportDialog:function(e){if(B){var t=(e=e||{}).eventId||this.lastEventId();if(!t)throw new s("Missing eventId");var n=e.dsn||this._dsn;if(!n)throw new s("Missing DSN");var r=encodeURIComponent,a="";a+="?eventId="+r(t),a+="&dsn="+r(n);var i=e.user||this._globalContext.user;i&&(i.name&&(a+="&name="+r(i.name)),i.email&&(a+="&email="+r(i.email)));var o=this._getGlobalServer(this._parseDSN(n)),c=B.createElement("script");c.async=!0,c.src=o+"/api/embed/error-page/"+a,(B.head||B.body).appendChild(c)}},_ignoreNextOnError:function(){var e=this;this._ignoreOnError+=1,setTimeout(function(){e._ignoreOnError-=1})},_triggerEvent:function(e,t){var n,r;if(this._hasDocument){for(r in t=t||{},e="raven"+e.substr(0,1).toUpperCase()+e.substr(1),B.createEvent?(n=B.createEvent("HTMLEvents")).initEvent(e,!0,!0):(n=B.createEventObject()).eventType=e,t)E(t,r)&&(n[r]=t[r]);if(B.createEvent)B.dispatchEvent(n);else try{B.fireEvent("on"+n.eventType.toLowerCase(),n)}catch(e){}}},_breadcrumbEventHandler:function(e){var t=this;return function(n){if(t._keypressTimeout=null,t._lastCapturedEvent!==n){var r;t._lastCapturedEvent=n;try{r=C(n.target)}catch(e){r="<unknown>"}t.captureBreadcrumb({category:"ui."+e,message:r})}}},_keypressEventHandler:function(){var e=this;return function(t){var n;try{n=t.target}catch(e){return}var r=n&&n.tagName;if(r&&("INPUT"===r||"TEXTAREA"===r||n.isContentEditable)){var a=e._keypressTimeout;a||e._breadcrumbEventHandler("input")(t),clearTimeout(a),e._keypressTimeout=setTimeout(function(){e._keypressTimeout=null},1e3)}}},_captureUrlChange:function(e,t){var n=R(this._location.href),r=R(t),a=R(e);this._lastHref=t,n.protocol===r.protocol&&n.host===r.host&&(t=r.relative),n.protocol===a.protocol&&n.host===a.host&&(e=a.relative),this.captureBreadcrumb({category:"navigation",data:{to:t,from:e}})},_patchFunctionToString:function(){var e=this;e._originalFunctionToString=Function.prototype.toString,Function.prototype.toString=function(){return"function"==typeof this&&this.__raven__?e._originalFunctionToString.apply(this.__orig__,arguments):e._originalFunctionToString.apply(this,arguments)}},_unpatchFunctionToString:function(){this._originalFunctionToString&&(Function.prototype.toString=this._originalFunctionToString)},_instrumentTryCatch:function(){var e=this,t=e._wrappedBuiltIns;function n(t){return function(n,r){for(var a=new Array(arguments.length),i=0;i<a.length;++i)a[i]=arguments[i];var s=a[0];return g(s)&&(a[0]=e.wrap({mechanism:{type:"instrument",data:{function:t.name||"<anonymous>"}}},s)),t.apply?t.apply(this,a):t(a[0],a[1])}}var r=this._globalOptions.autoBreadcrumbs;function a(n){var a=U[n]&&U[n].prototype;a&&a.hasOwnProperty&&a.hasOwnProperty("addEventListener")&&(q(a,"addEventListener",function(t){return function(a,i,s,o){try{i&&i.handleEvent&&(i.handleEvent=e.wrap({mechanism:{type:"instrument",data:{target:n,function:"handleEvent",handler:i&&i.name||"<anonymous>"}}},i.handleEvent))}catch(e){}var c,l,u;return r&&r.dom&&("EventTarget"===n||"Node"===n)&&(l=e._breadcrumbEventHandler("click"),u=e._keypressEventHandler(),c=function(e){if(e){var t;try{t=e.type}catch(e){return}return"click"===t?l(e):"keypress"===t?u(e):void 0}}),t.call(this,a,e.wrap({mechanism:{type:"instrument",data:{target:n,function:"addEventListener",handler:i&&i.name||"<anonymous>"}}},i,c),s,o)}},t),q(a,"removeEventListener",function(e){return function(t,n,r,a){try{n=n&&(n.__raven_wrapper__?n.__raven_wrapper__:n)}catch(e){}return e.call(this,t,n,r,a)}},t))}q(U,"setTimeout",n,t),q(U,"setInterval",n,t),U.requestAnimationFrame&&q(U,"requestAnimationFrame",function(t){return function(n){return t(e.wrap({mechanism:{type:"instrument",data:{function:"requestAnimationFrame",handler:t&&t.name||"<anonymous>"}}},n))}},t);for(var i=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],s=0;s<i.length;s++)a(i[s])},_instrumentBreadcrumbs:function(){var e=this,t=this._globalOptions.autoBreadcrumbs,n=e._wrappedBuiltIns;function r(t,n){t in n&&g(n[t])&&q(n,t,function(n){return e.wrap({mechanism:{type:"instrument",data:{function:t,handler:n&&n.name||"<anonymous>"}}},n)})}if(t.xhr&&"XMLHttpRequest"in U){var a=U.XMLHttpRequest&&U.XMLHttpRequest.prototype;q(a,"open",function(t){return function(n,r){return v(r)&&-1===r.indexOf(e._globalKey)&&(this.__raven_xhr={method:n,url:r,status_code:null}),t.apply(this,arguments)}},n),q(a,"send",function(t){return function(){var n=this;function a(){if(n.__raven_xhr&&4===n.readyState){try{n.__raven_xhr.status_code=n.status}catch(e){}e.captureBreadcrumb({type:"http",category:"xhr",data:n.__raven_xhr})}}for(var i=["onload","onerror","onprogress"],s=0;s<i.length;s++)r(i[s],n);return"onreadystatechange"in n&&g(n.onreadystatechange)?q(n,"onreadystatechange",function(t){return e.wrap({mechanism:{type:"instrument",data:{function:"onreadystatechange",handler:t&&t.name||"<anonymous>"}}},t,a)}):n.onreadystatechange=a,t.apply(this,arguments)}},n)}t.xhr&&A()&&q(U,"fetch",function(t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;++r)n[r]=arguments[r];var a,i=n[0],s="GET";if("string"==typeof i?a=i:"Request"in U&&i instanceof U.Request?(a=i.url,i.method&&(s=i.method)):a=""+i,-1!==a.indexOf(e._globalKey))return t.apply(this,n);n[1]&&n[1].method&&(s=n[1].method);var o={method:s,url:a,status_code:null};return t.apply(this,n).then(function(t){return o.status_code=t.status,e.captureBreadcrumb({type:"http",category:"fetch",data:o}),t}).catch(function(t){throw e.captureBreadcrumb({type:"http",category:"fetch",data:o,level:"error"}),t})}},n),t.dom&&this._hasDocument&&(B.addEventListener?(B.addEventListener("click",e._breadcrumbEventHandler("click"),!1),B.addEventListener("keypress",e._keypressEventHandler(),!1)):B.attachEvent&&(B.attachEvent("onclick",e._breadcrumbEventHandler("click")),B.attachEvent("onkeypress",e._keypressEventHandler())));var i=U.chrome,s=!(i&&i.app&&i.app.runtime)&&U.history&&U.history.pushState&&U.history.replaceState;if(t.location&&s){var o=U.onpopstate;U.onpopstate=function(){var t=e._location.href;if(e._captureUrlChange(e._lastHref,t),o)return o.apply(this,arguments)};var c=function(t){return function(){var n=arguments.length>2?arguments[2]:void 0;return n&&e._captureUrlChange(e._lastHref,n+""),t.apply(this,arguments)}};q(U.history,"pushState",c,n),q(U.history,"replaceState",c,n)}if(t.console&&"console"in U&&console.log){var l=function(t,n){e.captureBreadcrumb({message:t,level:n.level,category:"console"})};_(["debug","info","warn","error","log"],function(e,t){M(console,t,l)})}},_restoreBuiltIns:function(){for(var e;this._wrappedBuiltIns.length;){var t=(e=this._wrappedBuiltIns.shift())[0],n=e[1],r=e[2];t[n]=r}},_restoreConsole:function(){for(var e in this._originalConsoleMethods)this._originalConsole[e]=this._originalConsoleMethods[e]},_drainPlugins:function(){var e=this;_(this._plugins,function(t,n){var r=n[0],a=n[1];r.apply(e,[e].concat(a))})},_parseDSN:function(e){var t=I.exec(e),n={},r=7;try{for(;r--;)n[P[r]]=t[r]||""}catch(t){throw new s("Invalid DSN: "+e)}if(n.pass&&!this._globalOptions.allowSecretKey)throw new s("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return n},_getGlobalServer:function(e){var t="//"+e.host+(e.port?":"+e.port:"");return e.protocol&&(t=e.protocol+":"+t),t},_handleOnErrorStackInfo:function(e,t){(t=t||{}).mechanism=t.mechanism||{type:"onerror",handled:!1},this._ignoreOnError||this._handleStackInfo(e,t)},_handleStackInfo:function(e,t){var n=this._prepareFrames(e,t);this._triggerEvent("handle",{stackInfo:e,options:t}),this._processException(e.name,e.message,e.url,e.lineno,n,t)},_prepareFrames:function(e,t){var n=this,r=[];if(e.stack&&e.stack.length&&(_(e.stack,function(t,a){var i=n._normalizeFrame(a,e.url);i&&r.push(i)}),t&&t.trimHeadFrames))for(var a=0;a<t.trimHeadFrames&&a<r.length;a++)r[a].in_app=!1;return r=r.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(e,t){var n={filename:e.url,lineno:e.line,colno:e.column,function:e.func||"?"};return e.url||(n.filename=t),n.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(n.filename)||/(Raven|TraceKit)\./.test(n.function)||/raven\.(min\.)?js$/.test(n.filename)),n},_processException:function(e,t,n,r,a,i){var s,o=(e?e+": ":"")+(t||"");if((!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(t)&&!this._globalOptions.ignoreErrors.test(o))&&(a&&a.length?(n=a[0].filename||n,a.reverse(),s={frames:a}):n&&(s={frames:[{filename:n,lineno:r,in_app:!0}]}),(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(n))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(n)))){var c=b({exception:{values:[{type:e,value:t,stacktrace:s}]},transaction:n},i),l=c.exception.values[0];null==l.type&&""===l.value&&(l.value="Unrecoverable error caught"),!c.exception.mechanism&&c.mechanism&&(c.exception.mechanism=c.mechanism,delete c.mechanism),c.exception.mechanism=b({type:"generic",handled:!0},c.exception.mechanism||{}),this._send(c)}},_trimPacket:function(e){var t=this._globalOptions.maxMessageLength;if(e.message&&(e.message=w(e.message,t)),e.exception){var n=e.exception.values[0];n.value=w(n.value,t)}var r=e.request;return r&&(r.url&&(r.url=w(r.url,this._globalOptions.maxUrlLength)),r.Referer&&(r.Referer=w(r.Referer,this._globalOptions.maxUrlLength))),e.breadcrumbs&&e.breadcrumbs.values&&this._trimBreadcrumbs(e.breadcrumbs),e},_trimBreadcrumbs:function(e){for(var t,n,r,a=["to","from","url"],i=0;i<e.values.length;++i)if((n=e.values[i]).hasOwnProperty("data")&&p(n.data)&&!k(n.data)){r=b({},n.data);for(var s=0;s<a.length;++s)t=a[s],r.hasOwnProperty(t)&&r[t]&&(r[t]=w(r[t],this._globalOptions.maxUrlLength));e.values[i].data=r}},_getHttpData:function(){if(this._hasNavigator||this._hasDocument){var e={};return this._hasNavigator&&z.userAgent&&(e.headers={"User-Agent":z.userAgent}),U.location&&U.location.href&&(e.url=U.location.href),this._hasDocument&&B.referrer&&(e.headers||(e.headers={}),e.headers.Referer=B.referrer),e}},_resetBackoff:function(){this._backoffDuration=0,this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&F()-this._backoffStart<this._backoffDuration},_isRepeatData:function(e){var t=this._lastData;return!(!t||e.message!==t.message||e.transaction!==t.transaction)&&(e.stacktrace||t.stacktrace?j(e.stacktrace,t.stacktrace):!e.exception&&!t.exception||T(e.exception,t.exception))},_setBackoffState:function(e){if(!this._shouldBackoff()){var t=e.status;if(400===t||401===t||429===t){var n;try{n=A()?e.headers.get("Retry-After"):e.getResponseHeader("Retry-After"),n=1e3*parseInt(n,10)}catch(e){}this._backoffDuration=n||(2*this._backoffDuration||1e3),this._backoffStart=F()}}},_send:function(e){var t=this._globalOptions,n={project:this._globalProject,logger:t.logger,platform:"javascript"},r=this._getHttpData();r&&(n.request=r),e.trimHeadFrames&&delete e.trimHeadFrames,(e=b(n,e)).tags=b(b({},this._globalContext.tags),e.tags),e.extra=b(b({},this._globalContext.extra),e.extra),e.extra["session:duration"]=F()-this._startTime,this._breadcrumbs&&this._breadcrumbs.length>0&&(e.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),this._globalContext.user&&(e.user=this._globalContext.user),t.environment&&(e.environment=t.environment),t.release&&(e.release=t.release),t.serverName&&(e.server_name=t.serverName),e=this._sanitizeData(e),Object.keys(e).forEach(function(t){(null==e[t]||""===e[t]||y(e[t]))&&delete e[t]}),g(t.dataCallback)&&(e=t.dataCallback(e)||e),e&&!y(e)&&(g(t.shouldSendCallback)&&!t.shouldSendCallback(e)||(this._shouldBackoff()?this._logDebug("warn","Raven dropped error due to backoff: ",e):"number"==typeof t.sampleRate?Math.random()<t.sampleRate&&this._sendProcessedPayload(e):this._sendProcessedPayload(e)))},_sanitizeData:function(e){return H(e,this._globalOptions.sanitizeKeys)},_getUuid:function(){return O()},_sendProcessedPayload:function(e,t){var n=this,r=this._globalOptions;if(this.isSetup())if(e=this._trimPacket(e),this._globalOptions.allowDuplicates||!this._isRepeatData(e)){this._lastEventId=e.event_id||(e.event_id=this._getUuid()),this._lastData=e,this._logDebug("debug","Raven about to send:",e);var a={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};this._globalSecret&&(a.sentry_secret=this._globalSecret);var i=e.exception&&e.exception.values[0];this._globalOptions.autoBreadcrumbs&&this._globalOptions.autoBreadcrumbs.sentry&&this.captureBreadcrumb({category:"sentry",message:i?(i.type?i.type+": ":"")+i.value:e.message,event_id:e.event_id,level:e.level||"error"});var s=this._globalEndpoint;(r.transport||this._makeRequest).call(this,{url:s,auth:a,data:e,options:r,onSuccess:function(){n._resetBackoff(),n._triggerEvent("success",{data:e,src:s}),t&&t()},onError:function(r){n._logDebug("error","Raven transport failed to send: ",r),r.request&&n._setBackoffState(r.request),n._triggerEvent("failure",{data:e,src:s}),r=r||new Error("Raven send failed (no additional details provided)"),t&&t(r)}})}else this._logDebug("warn","Raven dropped repeat event: ",e)},_makeRequest:function(e){var t=e.url+"?"+x(e.auth),n=null,r={};if(e.options.headers&&(n=this._evaluateHash(e.options.headers)),e.options.fetchParameters&&(r=this._evaluateHash(e.options.fetchParameters)),A()){r.body=a(e.data);var i=b({},this._fetchDefaults),s=b(i,r);return n&&(s.headers=n),U.fetch(t,s).then(function(t){if(t.ok)e.onSuccess&&e.onSuccess();else{var n=new Error("Sentry error code: "+t.status);n.request=t,e.onError&&e.onError(n)}}).catch(function(){e.onError&&e.onError(new Error("Sentry error code: network unavailable"))})}var o=U.XMLHttpRequest&&new U.XMLHttpRequest;o&&(("withCredentials"in o||"undefined"!=typeof XDomainRequest)&&("withCredentials"in o?o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)e.onSuccess&&e.onSuccess();else if(e.onError){var t=new Error("Sentry error code: "+o.status);t.request=o,e.onError(t)}}:(o=new XDomainRequest,t=t.replace(/^https?:/,""),e.onSuccess&&(o.onload=e.onSuccess),e.onError&&(o.onerror=function(){var t=new Error("Sentry error code: XDomainRequest");t.request=o,e.onError(t)})),o.open("POST",t),n&&_(n,function(e,t){o.setRequestHeader(e,t)}),o.send(a(e.data))))},_evaluateHash:function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t[n]="function"==typeof r?r():r}return t},_logDebug:function(e){this._originalConsoleMethods[e]&&(this.debug||this._globalOptions.debug)&&Function.prototype.apply.call(this._originalConsoleMethods[e],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(e,t){f(t)?delete this._globalContext[e]:this._globalContext[e]=b(this._globalContext[e]||{},t)}},J.prototype.setUser=J.prototype.setUserContext,J.prototype.setReleaseContext=J.prototype.setRelease,e.exports=J}).call(this,n(0))},function(e,t,n){(function(t){var r=n(11),a="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},i=a.Raven,s=new r;s.noConflict=function(){return a.Raven=i,s},s.afterLoad(),e.exports=s,e.exports.Client=r}).call(this,n(0))},function(e,t,n){n(1),n(12),e.exports=n(4)}]);
//# sourceMappingURL=widget.js.map